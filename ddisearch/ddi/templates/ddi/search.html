{% extends "site_base.html" %}
{% load search_utils %}

{% block content %}
<h1>Search</h1>

{# always display search form; initial search, or revise current search #}
<form type="GET" action="{% url 'ddi:search' %}">
  {{ form.as_p }}
  <input type="submit"/>

</form>

{% if keywords %}
<hr/>
<p>Search terms: <b>{{ keywords }}</b>
{% endif %}
{% if results %}
<p>Found <b>{{ results.paginator.count }}</b> total results.</p>

<p>Number of results to show per page:
    {% for n in per_page_options %}
        {% ifequal n per_page %} {{ n }} {% else %}
        <a href="?{{ rechunk_params }}&amp;per_page={{ n }}">{{ n }}</a>
        {% endifequal %}
    {% endfor %}
    </p>

<p>Sort by:
    {% for s in sort_options %}
        {% ifequal s sort %} {{ s }} {% else %}
        <a href="?{{ sort_params }}&amp;sort={{ s }}">{{ s }}</a>
        {% endifequal %}
        {% if not forloop.last %} | {% endif %}
    {% endfor %}
    </p>


{% pagination_links results pages  url_params=url_params %}
{# TODO: consider using bootstrap pagination styles if we stick with bootstrap #}

<div style="width:90px;" class="pull-right">Relevance</div>

<ul>
{% for r in results.object_list %}
<li>
    <b>{{ r.title }}</b>
    {% if r.fulltext_score %} {# TODO: style this #}
    <div style="width:100px;" class="pull-right">
        <div class="progress">
          <div class="progress-bar" role="progressbar"
            aria-valuenow="{{ r.fulltext_score }}" aria-valuemin="0" aria-valuemax="1.5"
            style="width:{% widthratio r.fulltext_score 1 90 %}px">&nbsp;
           </div>
           {# style="width:{% widthratio r.fulltext_score  1 100 %}px">&nbsp;</div> #}
        </div>
        {# display numerical score in debug mode #}
        {% if debug %}{{ r.fulltext_score }}{% endif %}
    </div>
    {% endif %}

    <p>{{ r.abstract|truncatewords:100 }}</p>
    {% if r.keywords %}
      <p><b>Keywords:</b> {{ r.keywords|join:'; ' }}</p>
    {% endif %}

    <hr/>
</li>
{% endfor %}
<ul>
{% endif %}  {# search results present #}

{% endblock %}